{% extends "base.html" %}

{% block content %}


<h1>{{ auction.property_type }}</h1>
<div class="auction-details">
    <div class="auction-property_type">
        <strong>Adresa nemovitosti:</strong>
        {{ auction.address }}
    </div>

    <div class="auction-value">
        <strong>Odhad ceny nemovitosti:</strong>
            {{ auction.estimate_value }} Kč
    </div>

    <div class="auction-assurance">
        <strong>Dražební jistota:</strong>
            {{ auction.auction_assurance }} Kč
    </div>

    <div class="auction-min_bid">
        <strong>Minimální příhoz:</strong>
            {{ auction.min_bid }} Kč
    </div>
    {% if auction.isnot_start %}
        <div class="auction-date_auction">
            <strong>Datum dražby:</strong>
                {{ auction.date_auction|date:"d.m.Y H:i" }}
        </div>
    {% endif %}
    {% if auction.in_progress %}
        <div class="auction-time_of">
            <strong>Datum konce dražby:</strong>
            {{auction.date_end_auction|date:"d.m.Y H:i" }}

        </div>
    {% endif %}
<table>
    <tr>
        <td>
            <div>
                <strong>Aktuální čas:   </strong>
            </div>
        </td>
        <td>
             <div class="auction-local_time" id="clock">

        <script>
        function updateClock() {
            // Získání aktuálního času
            const now = new Date();

            // Formátování času
            const years = now.getFullYear().toString().padStart(1, '0')
            const moths = now.getMonth().toString().padStart(1, '0');
            const days = now.getDate().toString().padStart(1, '0')
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');

            // Složení času do formátu HH:MM:SS
            const currentTime = `${days}.${(Number(moths) + Number(1))}.${years}  ${hours}:${minutes}:${seconds}`;

            // Zobrazení času na stránce
            document.getElementById('clock').textContent = currentTime;
        }

        // Aktualizace času každou sekundu
        setInterval(updateClock, 1000);

        // První volání funkce, aby se čas zobrazil ihned při načtení stránky
        updateClock();

        </script>
    </div>
        </td>

    </tr>

</table>

    {% if auction.isnot_start %}
        <div class="auction-time_to">
            <strong>Zbývající čas do dražby:</strong>
                    {{ auction.time_key }}


                <script>
                    <p id="odpoctavani"></p>
                    function Clock_to() {
                        let cilovyDatum = new Date("12 31, 2024 05:05:05").getTime();

                        let odpoctavani = setInterval(function () {
                            let nyni = new Date().getTime();
                            let rozdil = cilovyDatum - nyni;

                            let dny = Math.floor(rozdil / (1000 * 60 * 60 * 24));
                            let hodiny = Math.floor((rozdil % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                            let minuty = Math.floor((rozdil % (1000 * 60 * 60)) / (1000 * 60));
                            let sekundy = Math.floor((rozdil % (1000 * 60)) / 1000);

                            // Zobrazení odpočítávání v elementu s id "odpoctavani"
                            document.getElementById("odpoctavani").innerHTML = `${dny}d ${hodiny}h ${minuty}m ${sekundy}s`;

                            if (rozdil < 0) {
                                clearInterval(odpoctavani);
                                document.getElementById("odpoctavani").innerHTML = "Odpočítávání skončilo!";
                            }
                        }, 1000);
                    }
                    Clock_to();
                </script>
        </div>
    {% endif %}

</div>

<div class="auction-description">
    <strong>Popis aukce: </strong>
    {{ auction.description }}
</div>

<div>
</div>
<div>
        {% if auction.in_progress %}
            <strong>Poslední příhoz: </strong>
                    {{ bid.bidder_name }}
        {% endif %}

<div>
    <strong>Fotogalerie:</strong>
</div>
<div class="auction-images">
    {% for image in auction.images.all %}
        <span class="auction-image">
            <img src="{{  image.image.url }}" alt="{{  image.description }}" width="150px">
        </span>
    {% endfor %}
</div>
<div>
    {% if auction.in_progress %}
        <form method="post">
            {% csrf_token %}
            <table>{{ form.as_table }}</table>
            <input id="id_submit" type="submit" value="Přihodit" class="btn btn-primary">
        </form>
    {% endif %}
</div>
<div>
        {% if auction.end and Bid.bid_date.exists %}
            <strong>Prodáno </strong>

        {% endif %}
</div>
<div>
        <div class="auction-bids">
            {% for bid in auction.bid.all %}
                <div class="auction-bid bg-light rounded mt-2 p-2 position-relative">
                    <div class="auction-bid-user-box">
                        <span class="auction-bid-user">
                            Uživatel: {{ bid.anonymizovat_jmeno }} {{ anonymizovat_přijmení }}
                        </span>
                        <span class="auction-bid-created font-italic text-secondary">
                            {{ bid.created|date:'d. m. Y H:i' }}
                        </span>
                    </div>
                    <div class="auction-bid-amount">
                        Příhoz: {{ bid.bid_amount }}
                    </div>
                </div>
            {% endfor %}
        </div>
</div>
{% endblock %}
